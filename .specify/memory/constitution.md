# PayrollMaster 薪资核算系统宪章

## 核心原则

### 一、文档驱动开发
所有功能开发必须严格遵循项目文档中的规范和规则。业务逻辑、设计方案和接口定义必须在相关文档中明确记录后才能进行开发。文档是开发的唯一依据，任何偏离文档的行为都需要先更新文档并获得批准。

**理由**：薪资系统涉及复杂的计算逻辑和法规要求，文档是确保系统准确性和可维护性的基础。

### 二、统一命名规范（强制要求）
项目中所有变量的命名必须使用驼峰命名法（camelCase），包括但不限于：
- 变量名：userName, salaryAmount, taxRate
- 函数名：calculateTax(), getEmployeeData()
- 类名：SalaryCalculator（类名首字母大写，其他用驼峰）
- 文件名：salaryCalculator.py, employeeService.js
- 数据库字段：employee_id 映射为 employeeId

**理由**：统一的命名规范提高代码可读性和一致性，降低维护成本。即便是Python开发也遵循此规范以保持项目整体风格统一。

### 三、测试驱动开发（不可协商）
所有新功能必须遵循TDD流程：
1. 编写测试用例（测试必须先于实现）
2. 确认测试失败
3. 编写最小化实现代码使测试通过
4. 重构优化代码

薪资计算逻辑必须具备完整的单元测试覆盖率达到90%以上。

**理由**：薪资计算涉及财务数据，准确性至关重要。TDD确保每个计算逻辑都经过验证。

### 四、模块化架构设计
系统必须采用模块化设计：
- 薪资计算模块独立
- 考勤管理模块独立
- 税务计算模块独立
- 员工信息管理模块独立

模块间通过清晰的接口通信，避免直接依赖。

**理由**：模块化设计便于维护、测试和扩展，特别是薪资规则变更时影响范围可控。

### 五、代码审查制度
所有代码变更必须经过同行审查：
- 审查重点：业务逻辑正确性、性能影响、安全漏洞
- 计算类代码需要至少2人审查
- 审查者必须运行测试用例并验证结果

**理由**：薪资系统的高风险特性要求多重验证机制。

### 六、数据安全与隐私保护
严格遵守数据安全要求：
- 员工敏感信息（身份证号、银行账号）必须加密存储
- 日志中不得记录完整身份证号或银行卡号
- 数据访问需要权限控制
- 定期进行安全审计

**理由**：员工个人信息和薪资数据属于敏感信息，必须严格保护。

### 七、准确性优先原则
薪资计算的准确性高于性能优化：
- 所有浮点数计算必须使用Decimal类型
- 金额计算保留两位小数，第三位四舍五入
- 税费计算遵循最新税法规定
- 计算结果需要双人复核机制

**理由**：薪资计算的错误直接影响员工利益，不容有失。

### 八、混合开发模式（强制要求）
项目采用"本地文档 + Docker沙箱"的混合开发模式：
- **文档管理**：所有需求、设计、规范文档在本地存储和编辑，支持离线访问和快速检索
- **运行环境**：代码在Docker容器中运行，确保环境隔离和一致性
- **开发流程**：本地修改代码 → 自动同步到容器 → 热重载生效 → 浏览器测试验证
- **标准命令**：使用 `bash start-dev.sh` 启动开发环境
- **访问地址**：
  - 前端应用：http://localhost:3000
  - 后端API：http://localhost:8000
  - API文档：http://localhost:8000/docs
  - pgAdmin：http://localhost:5050

**理由**：结合本地文档管理的便利性和容器化开发的隔离优势，提高开发效率并确保环境一致性。所有团队成员使用完全相同的开发环境，降低配置问题。

## 开发约束

### 技术栈要求
- 后端：Python 3.11+（基于FastAPI要求，强制使用驼峰命名）
- 数据库：PostgreSQL（支持事务的关系型数据库）
- 缓存：Redis（用于提高查询性能）
- 日志：结构化日志记录

### 性能标准
- 薪资计算响应时间：< 2秒（1000人以下）
- 系统并发支持：≥ 100用户
- 数据一致性：强一致性要求

### 合规要求
- 遵循当地劳动法规定
- 符合税务申报要求
- 数据存储符合隐私保护法规

## 开发工作流

### 混合开发模式流程
1. **本地文档准备** → 在本地编辑器中阅读需求文档、设计规范、API文档
2. **启动开发环境** → 执行 `bash start-dev.sh` 启动Docker开发环境
3. **本地代码开发** → 在本地编辑器修改代码，文件自动同步到容器
4. **实时验证** → 浏览器访问 http://localhost:3000 或 http://localhost:8000/docs 查看效果
5. **热重载调试** → 代码修改自动触发服务重启，无需手动操作
6. **数据库管理** → 通过 http://localhost:5050 访问pgAdmin进行数据库管理

### 标准开发流程
1. 需求分析 → 文档记录
2. 设计评审 → 文档更新
3. 测试用例编写 → 文档补充
4. 开发实现 → 编码规范检查
5. 自测 → 测试覆盖率验证
6. 同行评审 → 审查清单验证
7. 集成测试 → 系统测试
8. 部署上线 → 变更记录

### 环境管理规范
- **启动**：每天开发前执行 `bash start-dev.sh`
- **停止**：开发结束后执行 `docker-compose -f docker-compose.dev.yml down`
- **重启**：服务异常时执行 `docker-compose -f docker-compose.dev.yml restart`
- **日志**：使用 `docker-compose -f docker-compose.dev.yml logs -f` 查看实时日志
- **清理**：遇到环境问题时执行 `docker-compose -f docker-compose.dev.yml down -v --rmi all`

### 质量门禁
- 测试覆盖率 < 90% 禁止合并
- 代码审查未通过禁止合并
- 文档不完整禁止合并
- 性能测试失败禁止合并
- 开发环境未按规范启动禁止开发

## 治理规则

### 宪章地位
本宪章凌驾于所有其他开发实践之上，是项目的最高准则。任何开发决策都必须符合本宪章规定。

### 修订流程
1. 修订提案必须书面说明原因和影响
2. 全体开发团队评审
3. 管理层批准
4. 更新版本号和修订日期
5. 通知所有相关人员

### 合规检查
所有Pull Request必须验证以下合规项：
- [ ] 代码符合命名规范
- [ ] 测试用例完整
- [ ] 文档已更新
- [ ] 性能影响评估
- [ ] 安全风险评估

**Version**: 1.1.0 | **Ratified**: 2025-12-09 | **Last Amended**: 2025-12-11
