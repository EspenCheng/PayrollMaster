# PayrollMaster快速入门指南

## 概述

PayrollMaster是一个完整的薪资自动核算系统，支持Excel数据导入、薪资计算规则配置、自动薪资计算、结果预览和报表导出。本指南将帮助您快速上手系统的主要功能。

## 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 (React)  │    │  后端 (FastAPI)  │    │  数据库 (PostgreSQL) │
│                 │    │                 │    │                 │
│  - 用户界面      │◄──►│  - REST API     │◄──►│  - 员工数据     │
│  - 数据展示      │    │  - 业务逻辑      │    │  - 薪资规则     │
│  - 文件上传      │    │  - 数据验证      │    │  - 计算结果     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 环境要求

### 后端要求
- Python 3.11+
- PostgreSQL 12+
- Redis 6+(可选，用于缓存)

### 前端要求
- Node.js 16+
- npm 或 yarn

## 安装部署

### 1. 数据库设置

#### 创建数据库

```sql
CREATE DATABASE payroll_master;
CREATE USER payroll_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE payroll_master TO payroll_user;
```

#### 运行迁移

```bash
cd backend
alembic upgrade head
```

#### 初始化数据

```bash
python scripts/init_db.py
```

### 2. 后端服务

```bash
cd backend

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt

# 复制环境变量
cp .env.example .env
# 编辑 .env 文件，设置数据库连接信息

# 启动服务
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 3. 前端服务

```bash
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 4. 访问系统

打开浏览器访问：`http://localhost:3000`

默认管理员账号：
- 用户名：`admin`
- 密码：`admin123`

⚠️ **首次登录后请立即修改默认密码！**

## 快速上手流程

### 步骤1：创建用户账号

1. 使用管理员账号登录系统
2. 进入「用户管理」页面
3. 点击「创建用户」按钮
4. 填写用户信息：
   - 用户名：唯一标识
   - 邮箱：用于接收通知
   - 角色：选择适当的角色
     - `admin`：系统管理员，拥有所有权限
     - `manager`：部门经理，可查看本部门薪资
     - `accountant`：薪资核算员，可执行计算操作
     - `employee`：普通员工，仅可查看自己的薪资

### 步骤2：导入员工数据

#### 方式一：Excel批量导入(推荐)

**⚠️ 重要说明**：Excel文件采用双层表头格式

1. **准备Excel文件**，格式如下：

```
第1行(英文字段名)： employeeId | name | department | position | basicSalary | hireDate | bankAccount | phone | email
第2行(中文字段名)： 员工工号   | 姓名  | 部门       | 职位     | 基本薪资     | 入职日期 | 银行账号     | 联系电话 | 邮箱
第3行(数据开始)：   EMP001    | 张三  | 技术部      | 高级工程师 | 15000      | 2020-01-15 | 6222 **** **** 1234 | 138****1234 | zhangsan@company.com
                      EMP002    | 李四  | 市场部      | 市场专员 | 12000      | 2021-06-01 | 6222 **** **** 5678 | 139****5678 | lisi@company.com
```

**解析规则**：
- 第1行：英文字段名用于系统内部字段映射
- 第2行：中文字段名用于用户界面显示
- **第3行开始**：才是实际员工数据

2. 进入「员工管理」页面
3. 点击「导入Excel」按钮
4. 上传准备好的Excel文件
5. 系统会验证数据格式，显示验证结果
6. 确认无误后点击「确认导入」

#### 方式二：手动添加

1. 进入「员工管理」页面
2. 点击「添加员工」按钮
3. 填写员工信息
4. 点击「保存」

### 步骤3：配置薪资计算规则

1. 进入「薪资规则」页面
2. 点击「创建规则」按钮
3. 配置规则信息：

#### 奖金规则示例

```json
{
  "rule_name": "绩效奖金",
  "rule_type": "bonus",
  "calculation_type": "percentage",
  "value": 10.0,
  "description": "按基本薪资的10%计算绩效奖金"
}
```

#### 扣款规则示例

```json
{
  "rule_name": "迟到扣款",
  "rule_type": "deduction",
  "calculation_type": "fixed",
  "value": 50.0,
  "description": "每次迟到扣款50元"
}
```

#### 加班费规则示例

```json
{
  "rule_name": "加班费",
  "rule_type": "overtime",
  "calculation_type": "formula",
  "formula": "overtime_hours * basic_salary / 22 / 8 * 1.5",
  "description": "按基本薪资计算加班费，系数1.5"
}
```

### 步骤4：执行薪资计算

1. 进入「薪资计算」页面
2. 点击「执行计算」按钮
3. 填写计算参数：
   - **计算日期**：薪资周期(通常是月末)
   - **部门**：可选，指定部门则只计算该部门员工
   - **使用规则**：选择要应用的薪资规则
   - **预览模式**：可选，先预览结果不保存

4. 点击「开始计算」
5. 系统会显示计算进度

### 步骤5：预览和确认结果

1. 计算完成后，进入「薪资计算结果」页面
2. 查看每个员工的详细薪资明细：
   - 基本薪资
   - 各项奖金
   - 各项扣款
   - 社保公积金
   - 个人所得税
   - 实发工资

3. 检查无误后，点击「确认」按钮
4. 确认后的结果将标记为「已确认」状态

### 步骤6：导出报表

1. 进入「报表导出」页面
2. 选择报表类型：
   - **员工基础信息报表**：导出所有员工的基础信息
   - **薪资计算结果报表**：导出指定周期的薪资计算结果
   - **自定义报表**：根据需要自定义导出字段

3. 设置筛选条件：
   - 计算日期
   - 部门
   - 员工范围

4. 点击「导出Excel」按钮
5. 系统将生成Excel文件并自动下载

## 常用功能

### Excel导入最佳实践

#### 文件准备

1. **文件格式**：使用.xlsx格式(Excel 2007及以上版本)
2. **编码格式**：UTF-8编码
3. **数据格式**：
   - 日期格式：YYYY-MM-DD
   - 金额格式：保留两位小数
   - 手机号：11位数字

#### 常见错误及解决方法

| 错误信息 | 原因 | 解决方法 |
|---------|------|----------|
| 员工工号已存在 | 导入了重复的员工 | 检查Excel文件，确保员工工号唯一 |
| 基本薪资必须为正数 | 薪资字段有负数或空值 | 检查薪资数据，确保≥0 |
| 日期格式错误 | 日期不是标准格式 | 使用YYYY-MM-DD格式 |
| 邮箱格式不正确 | 邮箱地址不合法 | 检查邮箱格式，如：user@company.com |

### 薪资计算规则配置

#### 计算类型说明

- **fixed**：固定金额
  - 示例：交通补贴500元/月
  - 配置：`value: 500`

- **percentage**：百分比
  - 示例：绩效奖金按基本薪资的10%
  - 配置：`value: 10`(表示10%)

- **formula**：自定义公式
  - 示例：加班费 = 加班小时数 × 基本薪资 ÷ 22 ÷ 8 × 1.5
  - 配置：`formula: "overtime_hours * basic_salary / 22 / 8 * 1.5"`

#### 公式字段说明

可用字段：
- `basic_salary`：基本薪资
- `attendance_days`：出勤天数
- `overtime_hours`：加班小时数
- `late_count`：迟到次数
- `sick_leave_days`：病假天数
- `personal_leave_days`：事假天数

### 权限管理

#### 角色说明

| 角色 | 权限范围 |
|------|----------|
| admin | 系统管理员，拥有所有权限 |
| manager | 部门经理，可查看本部门薪资数据 |
| accountant | 薪资核算员，可执行计算和导出操作 |
| employee | 普通员工，仅可查看自己的薪资 |

#### 权限矩阵

| 功能 | admin | manager | accountant | employee |
|-----|-------|---------|------------|----------|
| 用户管理 | ✓ | ✗ | ✗ | ✗ |
| 员工管理 | ✓ | ✓ | ✓ | ✗ |
| 薪资规则配置 | ✓ | ✓ | ✓ | ✗ |
| 薪资计算 | ✓ | ✓ | ✓ | ✗ |
| 查看所有薪资 | ✓ | ✓ | ✓ | ✗ |
| 查看本人薪资 | ✓ | ✓ | ✓ | ✓ |
| 报表导出 | ✓ | ✓ | ✓ | ✗ |
| 数据备份 | ✓ | ✗ | ✗ | ✗ |

## 数据安全

### 敏感信息处理

- **密码**：使用bcrypt加密存储
- **身份证号**：支持加密存储
- **银行账号**：支持脱敏显示(如：6222 **** **** 1234)

### 审计日志

系统会记录所有关键操作：
- 用户登录/注销
- 数据创建/修改/删除
- 薪资计算操作
- 报表导出操作

日志记录包括：
- 操作时间
- 操作人员
- 操作类型
- 操作对象
- IP地址

### 数据备份

#### 自动备份

系统默认每日凌晨2点自动备份数据。

#### 手动备份

1. 进入「数据备份」页面
2. 点击「创建备份」按钮
3. 选择备份类型：
   - **完整备份**：备份所有数据
   - **增量备份**：备份变更的数据
4. 点击「开始备份」
5. 备份完成后可下载备份文件

#### 数据恢复

1. 进入「数据备份」页面
2. 选择要恢复的备份文件
3. 点击「恢复数据」按钮
4. 确认恢复操作

⚠️ **数据恢复将覆盖当前数据，请谨慎操作！**

## 性能优化建议

### 大数据量处理

- **Excel导入**：单次导入建议不超过1000条记录
- **薪资计算**：单次计算建议不超过5000名员工
- **报表导出**：大数据量建议分批导出

### 系统监控

- **API响应时间**：p95 < 200ms
- **数据库查询**：使用索引优化查询性能
- **内存使用**：监控内存使用情况，避免内存溢出

## 常见问题

### Q1: 如何处理员工离职？

**A**: 不建议直接删除员工记录，应该：
1. 在员工信息中标记「状态」为「已离职」
2. 保留历史薪资记录
3. 禁止对该员工进行新的薪资计算

### Q2: 薪资计算错误如何排查？

**A**: 检查步骤：
1. 查看员工考勤数据是否正确
2. 检查薪资计算规则配置
3. 查看系统日志，获取详细错误信息
4. 使用「预览模式」重新计算，观察中间结果

### Q3: 如何批量更新员工信息？

**A**: 使用Excel导入功能：
1. 导出当前员工数据(作为模板)
2. 修改Excel文件中的员工信息
3. 使用「覆盖模式」重新导入

### Q4: 系统支持多少并发用户？

**A**: 建议配置：
- **CPU**：4核心以上
- **内存**：8GB以上
- **数据库连接池**：最大100个连接
- **并发用户**：50-100个

### Q5: 如何导出特定部门的薪资报表？

**A**: 在导出报表时：
1. 选择「薪资计算结果报表」
2. 在筛选条件中指定「部门」
3. 点击「导出Excel」

## 技术支持

### 联系方式

- 邮箱：support@payrollmaster.com
- 电话：400-123-4567
- 在线文档：https://docs.payrollmaster.com

### 反馈渠道

- 系统内反馈功能：「帮助」→「意见反馈」
- GitHub Issues：https://github.com/payrollmaster/issues
- 用户社区：https://community.payrollmaster.com

## 更新日志

### v1.0.0 (2025-12-09)
- 初始版本发布
- 支持Excel数据导入
- 支持薪资计算规则配置
- 支持自动薪资计算
- 支持报表导出
- 支持用户权限管理

---

**快速入门完成！** 🎉

现在您已经掌握了PayrollMaster的基本使用方法。如需了解更多高级功能，请参考完整的技术文档。
